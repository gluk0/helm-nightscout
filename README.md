# helm-nightscout

A Helm chart for [Nightscout](https://nightscout.github.io/) - Web-based CGM (Continuous Glucose Monitor) to visualize and monitor glucose data in real-time from CGM devices. This helm chart is an inital pre-cursor to creating a SaaS solution ontop of nightscout, it can be used with a GitOps or event driven system to provision Nightscout instances on Kubernetes.

## Features

- ðŸš€ **Zero Configuration**: MongoDB and secrets auto-generated by default
- ðŸ”’ **Secure by Default**: Auto-generated strong passwords and API secrets
- ðŸ’¾ **Persistent Storage**: MongoDB data persists across restarts in a Kubernetes PVC.
- ðŸ”§ **Flexible**: Use integrated or external MongoDB in a flexible manner all driven by configuration for local development persistence.
- ðŸ“Š **Comprehensive**: Support for all Nightscout plugins and features currently available 15.0.3 of Nightscout (cgm-remote-monitor)

## Quick Start

Install with auto-generated MongoDB and secrets as a 'quick start' setup.

```bash
helm repo add nightscout https://gluk0.github.io/helm-nightscout
helm repo update
helm install my-nightscout nightscout/nightscout --namespace nightscout --create-namespace
```

Retrieve your auto-generated API secret:

```bash
kubectl get secret my-nightscout -n nightscout -o jsonpath='{.data.api-secret}' | base64 -d
```

## Installing the Chart

### Default Installation (with integrated MongoDB)

```bash
helm install my-nightscout nightscout/nightscout \
  --namespace nightscout \
  --create-namespace \
  --wait
```

### With Custom Configuration

Create a `values.yaml` file:

```yaml
# Use integrated MongoDB (default)
mongodb:
  enabled: true
  persistence:
    size: 20Gi  # Increase storage

nightscout:
  # Leave empty for auto-generation, or set custom values
  apiSecret: "your-secret-min-12-chars"
  baseUrl: "https://nightscout.example.com"
  customTitle: "My Nightscout"
  timezone: "America/New_York"

ingress:
  enabled: true
  className: nginx
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
  hosts:
    - host: nightscout.example.com
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: nightscout-tls
      hosts:
        - nightscout.example.com
```

Then install:

```bash
helm install my-nightscout nightscout/nightscout -f values.yaml \
  --namespace nightscout --create-namespace
```

### Using External MongoDB

To use an external MongoDB instance:

```yaml
mongodb:
  enabled: false  # Disable integrated MongoDB

nightscout:
  mongodbUri: "mongodb://user:password@external-host:27017/nightscout"
  apiSecret: "your-secret-min-12-chars"
```

## MongoDB Integration

This chart includes integrated MongoDB support. See [MONGODB.md](MONGODB.md) for detailed information about:

- Auto-generated credentials
- Retrieving secrets
- Configuration options
- High availability setup
- Migration guides
